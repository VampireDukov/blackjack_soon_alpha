<!DOCTYPE html>
<html>
<head>
	<title>Gra w oczko</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="styles/css.css">
	
</head>
<body>
<header>

	<h1>Gra w oczko, traf łączną liczbę 21, aby wygrać!</h1>

</header>	

<section id="content">
	<span id="my_result">0</span>
	<div id="my_table" class="table"></div>
	<div class="buttons">	
		<button id="click">Wybierz kartę!</button>
		<button id="check">Spasuj</button>
	</div>
	<div id="opponent_table" class="table"></div>
	<span id="opponent_result">0</span>	
</section>

<script type="text/javascript">
	
	const click = document.getElementById('click');
	const check = document.getElementById('check');

	const my_table = document.getElementById('my_table');
	const my_result = document.getElementById('my_result');

	const opponent_table = document.getElementById('opponent_table');
	const opponent_result = document.getElementById('opponent_result');

	var opp = 0;
	var opp_win;
	var me, me_win;

	const cards_value = ['as',2,3,4,5,6,7,8,9,10,'walet','dama','krol'];
	const cards_color = ['trefl','karo', 'serce','pik'];
	

	var card = 0;
	var i =0;

	function cardObjectConstructor(cards_color,cards_value){

		this.color = cards_color;
		this.value = cards_value;
	}	

	function shuffleArray(deck) {
    
    	for (var i=0; i<deck.length; i++) { 
        	
        	var j = Math.floor(Math.random() * deck.length);
        	var temp = deck[i];
        	deck[i] = deck[j]; 
        	deck[j] = temp; 
    	}
    

   	return deck;
	
	}

	function createCardObject(cards_color,cards_value){
		var n = 0;
		var cards_objects_array = [];

		for (var i = 0; i<cards_color.length;i++ ){
		
			for (var j = 0; j<cards_value.length;j++){
				
				cards_objects_array[n] = new cardObjectConstructor(cards_color[i], cards_value[j]);
			n++;	
			}

		}

		var shuffled_deck = shuffleArray(cards_objects_array); 
		return shuffled_deck;
	} 

	var deck = createCardObject(cards_color, cards_value);

	function getCard(deck,target){

		var value = createCard(deck[i],target);
		i++;
		return value
	}

	function createCard(deck,target)
	{
		var card = document.createElement('img');
		card.src = "cards/"+deck.color+"/"+deck.value+".jpg"; 
		card.classList.add('cards');
		
		deck_value = countValueCards(deck);
		target.appendChild(card);
		return deck_value;
	}

	function countValueCards(deck){

		if (typeof deck.value != 'number') {
			
			switch(deck.value){
				
				case 'walet':
					deck.value = 10
				break;

				case 'dama':
					deck.value = 10
				break;

				case 'krol':
					deck.value = 10
				break;

				case 'as':
					deck.value = 11
				break;
			}
		}
		return deck.value;
	}
	function checkValues(cards, opponent_cards){

	
		if (opponent_cards>cards) {

			alert('Przegrałeś. Przeciwnik był bliżej liczby 21');
			location.reload();
		}
		else{
			alert('Gratulacje, byłeś bliżej!');
		}

	}

	function chooseCard(deck,table,result){
		var card_value = getCard(deck,table);
		result.textContent = card_value + parseInt(result.textContent);
		return result.textContent;
	}

	function checkWinner(player){

		if(player===21){
			return true;
		}
		else if(player>21){
			return false;
		}
		else{
			return player;
		}
	}

	function removeEvent(){

		click.removeEventListener('click', chooseCard);
		click.removeEventListener('click', checkWinner);

		check.removeEventListener('click', checkWinner);
		
		location.reload();
	}

	click.addEventListener('click', function(){

		me = chooseCard(deck,my_table,my_result);
		me_win = checkWinner(me);
		
		if(opp<17){
			opp = chooseCard(deck,opponent_table,opponent_result);		
			opp_win = checkWinner(opp);
		}
		if(me_win==true || me == 21){
			alert('Gratulacje! Trafiłeś oczko!');
			setTimeout(function(){
				removeEvent();
			},1000);
		}
		else if (me_win == false || me>21) {
			alert("Spróbuj jeszcze raz, przekroczyłeś limit");
			setTimeout(function(){
				removeEvent();
			},1000);;
		}
		else if(opp_win==true || opp ==21){
			alert('Niestety przeciwnik trafił oczko');
			setTimeout(function(){
				removeEvent();
			},1000);
		}
		else if(opp_win==false || opp>21){
			alert('Przeciwnik przekroczył limit, wygrałeś!');
			setTimeout(function(){
				removeEvent();
			},1000);
			
		}
		


	});

	check.addEventListener('click',function(){

		while(opp<=16){

				opp = chooseCard(deck,opponent_table,opponent_result);
				
		}	
		opp_win = checkWinner(opp);
		if(me_win === opp_win){
			alert('Mamy remis');	
			setTimeout(function(){
				removeEvent();
			},1000);	
		}
		else if(me_win>opp_win){
			alert('Oczka nie trafiłeś, ale byłeś bliżej. Wygrałeś!');
			setTimeout(function(){
				removeEvent();
			},1000);
		}
		else
		{
			alert('Może następnym razem będzie lepiej? Przeciwnik wygrał.');
			setTimeout(function(){
				removeEvent();
			},1000);
		}
	});

	</script>
</body>
</html>